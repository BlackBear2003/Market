(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2f3cd8d5"],{"0f69":function(e,t,s){},"293a":function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"top-bar"},[t("div",{staticClass:"bodyContent body-flex"},[t("div",{staticStyle:{flex:"1"}}),t("el-card",{staticStyle:{width:"20%",padding:"0"}},[t("ul",e._l(e.userList,(function(s,a){return t("li",{staticClass:"user-list-item",class:{checked:e.checkedIndex===a},on:{click:function(t){return e.chatWith(s)}}},[e._v(" "+e._s(s.username)+" ")])})),0)]),t("el-card",[t("div",{staticClass:"chat"},[t("div",{staticClass:"chat-message-body"},e._l(e.data,(function(s,a){return t("div",{key:a,staticClass:"message-card",attrs:{"dis-hover":""}},[t("div",{class:s.username==e.username?"message-row-right":"message-row-left"},[t("div",{staticClass:"message-content"},[t("div",{style:s.username==e.username?"text-align:right;display: flex;flex-direction:row-reverse":""},[e._v(" "+e._s(s.username)+" "),t("span",{staticClass:"message-time"},[e._v(" "+e._s(s.createDate))])]),t("div",{staticClass:"message-body"},[e._v(" "+e._s(s.text)+" ")])])])])})),0),t("el-input",{staticStyle:{margin:"10px 0"},attrs:{type:"textarea",placeholder:"主动一点，世界会更大！",rows:4},model:{value:e.message.text,callback:function(t){e.$set(e.message,"text",t)},expression:"message.text"}})],1),t("div",{staticClass:"footer-btn"},[t("el-button",{attrs:{type:"primary"},on:{click:e.sendMsg}},[e._v("发送")])],1)]),t("div",{staticStyle:{flex:"1"}})],1),t("div",{staticClass:"footer"})])},n=[],o=(s("14d9"),s("d010a")),i=s("56d7");function r(){const e={code:200,data:Array.from(i["default"].$store.state.messageList)};return Promise.resolve(e)}function c(e){const t={code:200,data:"发送成功"};return i["default"].$store.commit("addMessage",e),Promise.resolve(t)}var l={components:{Icon:o["a"]},data(){return{stompClient:void 0,content:"",checkedIndex:"",data:[],username:localStorage.getItem("username"),interval:void 0,types:o["b"],userList:[],message:{username:localStorage.getItem("username"),chatMessageId:0,chatMessageType:"string",text:"",url:"string",createDate:"2022-12-01T02:17:03.481Z",senderId:0,receiverId:0,chatMessageStatus:0}}},methods:{chatWith(e){this.$store.commit("updateUsername",e),this.checkedIndex=this.userList.findIndex(t=>Object.is(e,t)),console.log("item:",e)},login(){console.log("=== login ==="),this.$router.push("/login")},chat(){console.log("=== chat ==="),this.$router.push("/chat")},getUserList(){console.log("=== getUserList ==="),this.userList=[{username:"小明"},{username:"小红"},{username:"小兰"}]},loadMsg(){r().then(e=>{200==e.code&&(console.log("data:",this.data),this.data=e.data)})},sendMsg(){this.data.push(this.message),console.log("store msgList:",this.$store.state.messageList),c({...this.message}).then(e=>{console.log("=== sendMsg res:",e)})},connect(){try{const e=new SockJS("/ws");this.stompClient=Stomp.over(e),this.stompClient.connect({token:localStorage.getItem("token")},this.onConnected,this.onError)}catch(e){console.log("err:",e)}},onConnected(){this.stompClient.subscribe("/user/chat/"+localStorage.getItem("userid"),this.onMessageReceived);const e={senderId:localStorage.getItem("userid"),receiverId:"4"};this.stompClient.send("/chat.beginChatWithOne",{},JSON.stringify(e))},onError(e){console.log("error:"),console.error(e)},sendMessage(e){if(this.content&&this.stompClient){const e={chatMessageType:"TEXT",senderId:localStorage.getItem("userid"),text:this.content,receiverId:"4"};console.log("----- ："+e),this.stompClient.send("/chat.sendTo0ne",{},JSON.stringify(e))}e.preventDefault()},onMessageReceived(e){var t=JSON.parse(e.body);console.log("recv msg:",t),"JOIN"===t.type?(messageElement.classList.add("event-message"),t.content=t.sender+" 上线~!"):"LEAVE"===t.type&&(messageElement.classList.add("event-message"),t.content=t.sender+" 离线了!")}},mounted(){console.log("mounted"),this.loadMsg(),this.interval=setInterval(()=>{this.loadMsg()},2e3),this.getUserList()},destroyed(){clearInterval(this.interval)}},d=l,g=(s("7533"),s("c90d"),s("2877")),m=Object(g["a"])(d,a,n,!1,null,null,null);t["default"]=m.exports},7533:function(e,t,s){"use strict";s("b1db")},b1db:function(e,t,s){},c90d:function(e,t,s){"use strict";s("0f69")}}]);
//# sourceMappingURL=chunk-2f3cd8d5.2a20a89a.js.map